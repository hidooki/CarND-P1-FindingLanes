# **Finding Lane Lines on the Road**


---

**Finding Lane Lines on the Road**

The goals / steps of this project are the following:
* Make a pipeline that finds lane lines on the road
* Reflect on your work in a written report


[//]: # (Image References)

[image1]: ./test_images_output/solidWhiteCurve_Segment.jpg "SolidWhite_Segment"

[image2]: ./test_images_output/solidWhiteCurve_Cont.jpg "SolidWhite_Cont"

---

### Reflection

### 1. Describe your pipeline. As part of the description, explain how you modified the draw_lines() function.


I first focused on finding the best line segments I could for the given images.
I did this by tweaking the input parameters in the helper functions. After
converting to grayscale, I applied a tiny kernel to the gaussian blur, just
enough to give a change to the subsequent Canny algorithm to pick up all shades
with an 'edge' potential, but not too much as to disturb the obvious lines. I then
played with the thresholds in the Canny transform trying to get a clear line
outline in front of the car and not pick up too many false positives in the center
of the screen (where edges become harder to detect due to many cars in the proximity
of each other).

I then moved on to zooming in to the central part of the image, the lane ahead
where the driver's focus most often is. I specified this image restriction in
relative terms (fractions of image shape), so that it works with images of
potentially different sizes.

Finally I moved on to detecting lines in the image, by running a Hough transform
on the Canny edges. This step proved to be a bit tricky, as one has to find the
right balance between picking up several of the line segments on the discontinuous
side of of the lane, while keeping the noise at bay. I had to go back to the Canny
step a couple of iterations, until I found a parameter combination which I was happy with.

This is a sample of what I had at this point:

![alt text][image1]

I then started working on extrapolating the lane segments into one solid line
on each side of the driving lane.

(Because I like the 'segmented' solution so far, I started writing a separate _extrapolator_ function for the 'continuous' case, while I left the provided draw_lines template unchanged).

I separated
the Hough lines into two clusters, representing the left and the right lane respectively. (I did this based on their slope). For each side, I sorted the segments
based on their slopes and I discarded everything but the second and third quartile (this rid me of outliers like small lines perpendicular to the road). The slope of the resulting line would be just the average of the slopes of the remaining 'relevant segments'. I picked the line intercept as the solution of a least squares problem by running a line of given slope through the midpoints of the 'relevant' segments. I extrapolated the resulting left and right lines to the edges of the image.

![alt text][image2]

In order to make the lines change smoothly in a video clip, I ran an exponential filter on the slopes and on the intercepts. Because my pipeline would always have to remember the running average so far, I implemented it with a _closure_ in Python (where each pipeline is generated by a pipeline factory, where the running averages are passed inside the factory so that they are part of the context of the pipeline).

The final video output looked very similar to provided examples (in my opinion at least :smiley:). However, the 'challenge' proved to be a bit too tall an order for this simplistic approach.





### 2. Identify potential shortcomings with your current pipeline


One potential shortcoming would be that the exponential filter I used is agnostic
to the speed of the car. So while the decay parameters I picked (alpha) might be
acceptable for the current speeds, the reaction time could be inadequate if the
speed changes significantly and/or the road begins to wind more.

Another shortcoming could be that I have not tested my solution on rainy images...
Would my algorithm pick up the correct lanes from among rain droplets on the windshield? Unclear... (Although night images might make the problem easier,
they would still require testing). Or what if another car cuts in front of me,
will my algorithm be able to stay focused on the road and not pick up any of the
car's edges? And so many other unknowns..



### 3. Suggest possible improvements to your pipeline

There are several improvements one could think of, like for instance trying to fit a curve to the lane segments (for example splines are popular in similar situations in Financial Mathematics) instead of straight lines. (This is called upon in light of the situation depicted in the project's 'challenge').

One could think of many other similar tricks. While they would likely work well
on the given videos, I am pessimistic that _this_ is the right approach to solving this problem in general. It seems to me that, no matter how clever a fitting algorithm one could come up with, Mother Nature could always spring a novel situation (image) upon one's driver, which will confuse one's _programmed_ solution. I would hope that a _learning_ technique would work better, where the algorithm learns what a road _is_ by looking at many pictures, as opposed to the engineer having to "define" the road in mathematical equations. So I am looking forward to the next techniques :smiley:
